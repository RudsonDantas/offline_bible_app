# About
Node-auth provides an interface to Auth for Sovee's node.js applications. Once set up, your app will auto-magically be protected by auth.

# Dependencies
1. Express (tested on >=4.x)

# Optional configuration
If you are going to use routes outside of your API path then you must use [express-session](https://github.com/expressjs/session) to store session data. **Note**: Routes mounted behind the `api.url` always require a token be passed. Sessions do not apply to them.

The following session objects will be available to you:

1. `req.session.token`
2. `req.session.user`

# Usage

First, you'll need to install with something like this:

```bash
npm install git+https://firma8deploy:PASSWORD@bitbucket.org/firma8/nodeauth.git#v2.0.2 --save
```

Next, you'll add the require:

```javascript
var express = require('express'),
    app = express(),
    session = require('express-session'),
    auth = require('node-auth');
```

Then, *after you set up the session*, you'll init auth:

```javascript
app.use(session({secret: process.env.SESSION_SECRET});

mw = auth({
  auth: {
    host: process.env.AUTH_URL
  },
  loginErrorHandler: loginErrorHandler,
  unprotectedUrls: ['/freedom']
});

app.use('/api', mw.api);
app.use(/^\/(?!api(\/|$)).*$/, mw.app);
app.use(mw.routes);
```

## Options
### auth (required)
* host (required) - The host to use for the auth application. Will probably be either `https://auth.sovee.com/` or `https://staging-auth.sovee.com/`.

### api
* url - The base path for your API

### loginErrorHandler
This will be a function you define in your app to handle what occurs when there is a problem communicating with auth.

### unprotectedUrls
An array of paths that anyone can see without signing in.
